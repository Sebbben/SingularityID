# Internal flow

**Resource owner** - the person that owns the resource  
**Client** - a service that wants to make requests on behalf of a resource owner  
**Auth server** - this server, responsible for determining if the client should be granted an access token  
**Resource server** - server containing the resource owner's resource. A resource may be, for example, making an API request, accessing user data, etc. The resource server and client may be the same entity, but should still use the access token for validating permission.

This flow grants a client an access token so that the client can make requests on behalf of the resource owner.

## Authorization Code Flow with PKCE

### Step 1: Client Generates Code Verifier and Challenge
Client generates a code verifier and code challenge.

### Step 2: Client Requests Authorization
Client sends a GET request to the auth server with the following parameters:
 - `response_type` (string) - must always be "code"
 - `client_id` (string) - ID of the client 
 - `redirect_uri` (string) - one of the URIs registered with the client 
 - `state` (string) - string that the service provider can use for maintaining state after login
 - `code_challenge` (string) - the code challenge derived from the code verifier
 - `code_challenge_method` (string) - the method used to derive the code challenge (e.g., "S256")

### Step 3: User Logs In
User logs in and grants access to the client.

### Step 4: Auth Server Redirects
Auth server redirects to the client's `redirect_uri` with the following parameters:
 - `code` (string) - the authorization code generated by the auth server
 - `state` (string) - the state parameter received from the client
Here it is important to retain the params in the redirect-uri when adding the code and state params.

### Step 5: Client Requests Token
Client makes a POST request to the auth server's token endpoint with the following parameters:
 - `grant_type` (string) - must be "authorization_code"
 - `code` (string) - the authorization code received from the auth server
 - `redirect_uri` (string) - the same `redirect_uri` used in Step 2
 - `client_id` (string) - ID of the client
 - `code_verifier` (string) - the original code verifier generated by the client

### Step 6: Auth Server Issues Token
Auth server validates the authorization code and code verifier, then returns an access token to the client.
